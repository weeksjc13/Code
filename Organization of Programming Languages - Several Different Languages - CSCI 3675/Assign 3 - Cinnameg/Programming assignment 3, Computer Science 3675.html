<html>
<head>
  <title> Programming assignment 3, Computer Science 3675 </title>
  <link rel="stylesheet" href="../assignment.css" type="text/css">
</head>
<body>
<h2>
   Computer Science 3675<br>
   Section 001<br>
   Fall 2017<br>
   Programming Assignment 3
</h2>

<div align="center">
<table> 
  <tr> 
    <td><b>Assigned:</b></td>
    <td>Wednesday, September 20</td>
  </tr>
  <tr>
    <td><b>Due:</b></td>
    <td>Wednesday, October 4, 11:59pm</td>
  </tr>
</table>
</div>
 
<h3>
  <font color="mediumblue">Purpose of this assignment</font>
  <hr class="heading">
</h3>

<p>This is an exercise to see how a nontrivial program can be
written using pure functions.
<i>The goal is to write short and simple programs.</i>
In a few places you will need to use imperative operations
that call for doing something, but that should be
kept to a bare minimum.
Instead, just describe what you want using equations.
(Note: giving something a name, as in ! <i>x</i> = <i>y</i>, is considered
a functional style, since all you are doing is naming something, not
changing something.)
</p>

<p>Where possible and convenient, use higher order 
functions to make your work simpler.  Let function-building
factories build your functions for you.
</p>

<p>Read the entire assignment.
Then follow the steps listed.  Look at what each step is
doing for you on a small made-up example, by hand.
If you do the program step 
by step, you will find that the individual steps are 
very short and simple, and you get a working 
product quite quickly.  
</p>

<p><blockquote>
<font size="+1"><b>Do not try to write the entire 
program and then test it, regardless of how appealing that approach
might seem to you right now.
Test each function as you go.  Include examples in your definitions.
<i>Failure to do this will cause you grief</i>.</b></font>
</blockquote>
</p>

<h3>
  <font color="mediumblue">The RSA system</font>
  <hr class="heading">
</h3>

<p>For this exercise, 
you will encipher and decipher files using the RSA system.
(The name comes from the names of the authors of a paper that described
it: Rivest, Shamir and Adleman.)
<!--RSA is an industrial strength cryptographic system used in such applications
as PGP. -->
</p>

<p>Please read <a href="rsa.html">how the RSA system works</a>.
</p>

<h3>
  <font color="mediumblue">The Assignment</font>
  <hr class="heading">
</h3>

<p>For this assignment, you will write four Cinnameg packages.
<ol>
  <li> A package holding some support functions (called convert.cmg);</li>
  <li> A program to compute the key sets (called keygen.cmg);</li>
  <li> A program to encipher (called encipher.cmg);</li>
  <li> A program to decipher (called decipher.cmg).</li>
</ol>
</p>

<p>You will need to import some library packages.  See
<a href=help3.html#library>[Hints on importing library packages]</a>.
</p>

<p>You will probably find it helpful to include
<a href="help3.html#tags">type information</a> in your
program.  They will make it more clear to you what each
function does.
</p>


<h3>
  <font color="mediumblue">Assignment, Part 1. Strings and Numbers</font>
  <hr class="heading">
</h3>

The RSA system enciphers integers.  
What you want to encipher, however, is a string.  Also, you 
will find it convenient to use a string as the key that the user
gives you.  The user might need to remember the key, and strings are
easier to remember than numbers.
</p>

<p>So you need a way to 
convert from strings to integers and back.  Create a function
stringToNumber that converts a string into a number (a nonnegative integer), 
and another function numberToString that converts
back.  (So numberToString(stringToNumber(<i>t</i>)) = <i>t</i>.
That is, stringToNumber and numberToString are inverses of one
another.)
</p>

<p>These functions will
be useful in more than one place, so put them into a package 
convert.cmg.
Your package will look something like the following.  
(The <i>expect</i> part
tells other packages that functions stringToNumber and numberToString 
are defined here, and what their types are, but does not say 
how they work. Parts in black should be written exactly as they
are here.  Parts in red need to be replaced with your definitions.)
<pre>
Package convert

=========================================================
export

Expect
  stringToNumber: String -&gt; Integer;
  numberToString: Integer -&gt; String;
%Expect

=========================================================
implementation

 <span class="red"><i>Your definitions go here.</i></span>

%Package
</pre>
</p>

<p>After you write these functions, be sure to test them before going on.
Be sure that numberToString(stringToNumber(<i>t</i>)) = <i>t</i>.<br>
<a href="help3.html#stringToNumber">[Hint on writing stringToNumber]</a><br>
<a href="help3.html#numberToString">[Hint on writing numberToString]</a> 
</p>


<h3>
  <font color="mediumblue">Assignment, Part 2. Selecting Keys</font>
  <hr class="heading">
</h3>

<p>The user will give you two things, on two lines.
</p>  

<p>The first is
a <i>security parameter</i>, <i>s</i>,
indicating how much security is desired.
It is a positive integer.
A security parameter of 2 will give very low security (but rapid
computation), and a
parameter of 50 will give higher security (but very slow computation).
</p>

<p>The second thing that the user will give you is a key string, 
which is used to
compute the key integers <i>n</i>, <i>e</i> and <i>d</i>
that the RSA system needs.
</p>

<p>Write a program that reads the security parameter <i>s</i>
and the key string and
computes the numbers <i>n</i>, <i>e</i> and <i>d</i>.
The program should do the following.
<ol>
  <li><p> 
    Select prime numbers <i>p</i> and <i>q</i>
    at random from the the range from 256<sup><i>s</i></sup>
    to 256<sup><i>s</i>+1</sup>.<br>
    <a href="help3.html#selectpq">[Hint on selecting <i>p</i> and <i>q</i>]</a>.
  </p></li>

  <li><p>
    Compute <i>n</i> = <i>pq</i>, <i>e</i> and <i>d</i> as described in 
    <a href="rsa.html">the RSA system</a>.<br>
    <a href="help3.html#phiande">[Hint on getting &phi; and <i>e</i>]</a><br>
    <a href="help3.html#selectd">[Hint on getting <i>d</i>]</a>
  </p></li>

  <li><p>Write the ordered triple
  (<i>s</i>, <i>n</i>, <i>e</i>) to one file, 
  called pub.key, and the ordered triple
  (<i>s</i>, <i>n</i>, <i>d</i>) to another file called priv.key.  
  You can use procedure
  <a href="http://www.cs.ecu.edu/~karl/cinnameg/9-2/lin/Manual/Library/System/File/Write/write.html#WriteFile">WriteFile</a>
  to write the files.
  </p></li>
</ol>

<p>To get a string from the user, 
just get an entire line.  Use 
<a href="http://www.cs.ecu.edu/~karl/cinnameg/9-2/lin/Manual/Library/Simple/Numbers/fromstring.html#stringToInteger">stringToInteger</a> 
to convert a string of decimal digits to an integer.<br>
<a href=help3.html#getline>[Hint on getting a line]</a>
</p>


<h3>
  <font color="mediumblue">Part 3. Enciphering</font>
  <hr class="heading">
</h3>

<h4>The command line</h4>

<p>Write a program that enciphers.
Command line
<pre>
  cmgr encipher myfile.txt myfile.cph
</pre>
should write an enciphered version of myfile.txt into
file myfile.cph.
The program should read the key set (<i>s</i>, <i>n</i>, <i>e</i>) 
from file pub.key.<br>
<a href=help3.html#getkeytriple>[Hint on getting the key triple]</a>
</p>

<p>The command line arguments can be obtained from 
<a href="http://www.cs.ecu.edu/~karl/cinnameg/9-2/lin/Manual/Library/System/commandline.html">commandLine</a>.
In the example above, commandLine is the list 
[&quot;myfile.txt&quot;, &quot;myfile.cph&quot;].
</p>

<h4>The process of enciphering</h4>

<p>Write a function that enciphers a file by performing a
chain of transformations.  Function encipherFile will take
the key parameters <i>s</i>, <i>n</i> and <i>e</i> and
a file name (or path)
and will yield an enciphered version of the contents of
the named file.  Make your definition of encipher clearly
show the chain of transformations, similar to the following.
</p>
<pre>
  Define encipherFile (s, n, e) (filename) =
    filename ~&gt; <font color="red"><i>stage1</i></font>
             ~&gt; <font color="red"><i>stage2</i></font>
             ~&gt; <font color="red"><i>stage3</i></font>
             ...
  %Define
</pre>

<p>Each stage should be computed by a named or constructed
function.  Some of the stage descriptions below use the word <i>each</i>.
What does that tell you about the nature of the function?
</p>

<ol>
  <li><p>
    Stage 1 converts the file name to the file contents
    (a string).
    Imagine that the file contains &quot;abcedfghijk&quot;.
    See function
    <a href="http://www.cs.ecu.edu/~karl/cinnameg/9-2/lin/Manual/Library/System/File/Read/filecontents.html#fileContents">fileContents</a>.
  </p></li>

  <li><p>
    Stage 2 converts the file contents to a list of strings
    by cutting it into blocks of size <i>s</i>.  Suppose
    that <i>s</i> = 2.  Then this stage yields
    [&quot;ab&quot;, &quot;ce&quot;, &quot;df&quot;, &quot;gh&quot;, &quot;ij&quot;, &quot;k&quot;].<br>
    <a href="help3.html#breakup">[Hint on breaking up a string]</a>
  </p></li>

  <li><p>
    Stage 3 adds salt to the beginning of each string.  The salt is 
    a random string of <i>s</i> lower-case letters.  The result
    in the example might be 
    [&quot;xqab&quot;, &quot;eyce&quot;, &quot;ardf&quot;, &quot;atgh&quot;, &quot;zwij&quot;, &quot;gfk&quot;].
    <a href="help3.html#salt">[Hint on adding salt]</a>
  </p></li>

  <li><p>
    Stage 4 converts each string to a number.
  </p></li>

  <li><p>
    Stage 5 enciphers each number, using the RSA encipher function
    with <i>n</i> and <i>e</i>.
  </p></li>

</ol>

<p>Then, to perform enciphering, just write encipherFile(<i>fname</i>)
to the enciphered file, where <i>fname</i> is the file to encipher.<br>
<a href="help3.html#writelist">[Hint on writing to a file]</a>


<h3>
  <font color="mediumblue">Part 4. Deciphering</font>
  <hr class="heading">
</h3>

<p>To decipher, reverse the process.  Command
<pre>
   cmgr decipher myfile.cph myfile.plain
</pre>
should write the deciphered version of myfile.cph
into file myfile.plain.
The decipher program should get the private key information 
from file priv.key.  Just look at the steps of enciphering, and
back them up.  That is, do them in reverse order, replacing
each function by its inverse function.<br>
<a href="help3.html#readlist">[Hint on reading a list from a file]</a>
</p>

<p>The deciphered version of the file should
be identical to the original.  The Linux command diff compares files and
tells you how they differ.  If you do the encipher and decipher
operations shown, and then do command
<pre>
   diff myfile.txt myfile.plain
</pre>
then you should find no differences.  (The diff command will not
show anything at all to show that there are no differences.)
If there are any differences at all, fix your program.
</p>

<p>See 
<a href=help3.html#readlist>[Hint on reading a list]</a> to see how
to read the enciphered file in, getting ready to decipher.
</p>

<h4>Reporting progress</h4>

<p>The decipher program will be fairly slow when <i>n</i> is large.  
<b>After the program works</b>, modify the encipher and decipher programs so that they
say how many individual strings 
must be enciphered or deciphered, and then print
a dot as each string is finished.  Put all of the dots on one line.
So use 
<a href="http://www.cs.ecu.edu/~karl/cinnameg/9-2/lin/Manual/Library/System/File/Write/write.html#Display">Display</a> 
instead of 
<a href="http://www.cs.ecu.edu/~karl/cinnameg/9-2/lin/Manual/Library/System/File/Write/write.html#Displayln">Displayln</a>.  
This should be a very easy modification.  
If it looks difficult, you are missing something.
Note that this is an imperative aspect of the program.
You are performing an action while computing results.
</p>

<p>Be careful.  
The Display procedure accumulates a string into a buffer and only
prints the buffer when it is ready.  You will want to flush the
buffer at each write, so that the progress can be seen.  Use 
<pre>
   <a href="http://www.cs.ecu.edu/~karl/cinnameg/9-2/lin/Manual/Library/System/File/Write/write.html#Flush">Flush</a>.
</pre>
to flush the standard output buffer.
</p>

<h3>
  <font color="mediumblue">Turning in your program.</font>
  <hr class="heading">
</h3>

<p>Turn in the source code of your program using the submit program, as
assignment 3.
<pre>
   ~abrahamsonk/3675/bin/submit 3 convert.cmg keygen.cmg encipher.cmg decipher.cmg
</pre>
Command
<pre>
   ~abrahamsonk/3675/bin/submit 3
</pre>
will tell you what you have submitted.
</p>

<p><b>Be sure to include your name in <i>every</i> source file.</b>
</p>

<p>&nbsp;</p>
<p>&nbsp;</p>
</body>
</html>

